<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Ga≈°piho hra</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #111;
      font-family: sans-serif;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    #gameCanvas {
      flex: 1;
      width: 100%;
      display: block;
      border: 3px solid white;
      touch-action: none;
    }

    #touchControls {
      background: #111;
      padding: 10px 0;
      text-align: center;
      z-index: 1000;
    }

    #touchControls button {
      font-size: 28px;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 12px;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="touchControls">
  <button id="leftBtn">‚¨ÖÔ∏è</button>
  <button id="jumpBtn">‚è´</button>
  <button id="rightBtn">‚û°Ô∏è</button>
  <button id="shootBtn">üî´</button>
</div>

<script>
// === Inicializace pl√°tna ===
const GAME_WIDTH = 800;
const GAME_HEIGHT = 600;
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let floorY;
let scaleFactor;

function resizeCanvas() {
  const aspectRatio = GAME_WIDTH / GAME_HEIGHT;
  const aspectRatio = 800 / 600; // P≈Øvodn√≠ pomƒõr stran (800x600)
  canvas.width = window.innerWidth;
  if (window.innerWidth / window.innerHeight > aspectRatio) {
    canvas.height = window.innerHeight;
    canvas.width = canvas.height * aspectRatio;
  } else {
    canvas.width = window.innerWidth;
    canvas.height = canvas.width / aspectRatio;
  }

  scaleFactor = canvas.width / 800; // P≈ôepoƒçet ≈°k√°lov√°n√≠
  floorY = canvas.height - 10;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// === Obr√°zky ===
const playerImage = new Image();
playerImage.src = "hotdog-sad.png";
const bulletImage = new Image();
bulletImage.src = "parek.png";
const enemyImage = new Image();
enemyImage.src = "enemy.png";

const shootSound = new Audio("mortar.mp3");
const explosionSound = new Audio("explosion.mp3");

// === Hr√°ƒç ===
const originalSpeed = 2;
const originalJumpForce = -10;
const originalWidth = 120;
const originalHeight = 170;

const player = {
  x: 50,
  y: 50,
  width: 120,
  height: 170,
  velX: 0,
  velY: 0,
  speed: 2,
  jumpForce: -10,
  gravity: 0.2,
  grounded: false
};

const gravity = 0.2;

const platforms = [
  { x: 200, y: 450, width: 100, height: 20 },
  { x: 130, y: 100, width: 100, height: 20 },
  { x: 400, y: 350, width: 100, height: 20 },
  { x: 520, y: 175, width: 100, height: 20 }
];

let enemy = {
  x: 100,
  y: 50,
  baseX: 150,
  baseY: 150,
  width: 75,
  height: 75,
  alive: true,
  angle: 0,
  radiusX: 100,
  radiusY: 70,
  speed: 0.03
};

const bullets = [];
const bulletSpeed = 1.5;
const bulletWidth = 55;
const bulletHeight = 45;
let lastDir = 1;
let ammo = 5;

const keys = {};

document.addEventListener("keydown", (e) => {
  keys[e.key] = true;
  if (e.key === "ArrowLeft" || e.key === "a") lastDir = -1;
  if (e.key === "ArrowRight" || e.key === "d") lastDir = 1;
  if (e.key === "e" || e.key === "E") shootBullet();
});
document.addEventListener("keyup", (e) => {
  keys[e.key] = false;
});

function updatePlayer() {
  if (keys["ArrowLeft"] || keys["a"]) player.velX = -player.speed;
  else if (keys["ArrowRight"] || keys["d"]) player.velX = player.speed;
  else player.velX = 0;

  if ((keys["ArrowUp"] || keys["w"]) && player.grounded) {
    player.velY = player.jumpForce;
    player.grounded = false;
  }

  player.velY += player.gravity;
  player.x += player.velX;
  player.y += player.velY;

  player.grounded = false;

  if (player.y + player.height >= floorY) {
    player.y = floorY - player.height;
    player.velY = 0;
    player.grounded = true;
  }

  platforms.forEach(p => {
    const withinX = player.x + player.width > p.x && player.x < p.x + p.width;
    const isFalling = player.velY >= 0;
    const hittingTop = player.y + player.height <= p.y + player.velY &&
                       player.y + player.height + player.velY >= p.y;

    if (withinX && isFalling && hittingTop) {
      player.y = Math.round(p.y - player.height);
      player.velY = 0;
      player.grounded = true;
    }
  });
}

function shootBullet() {
  if (ammo > 0) {
    bullets.push({
      x: player.x + (lastDir === 1 ? player.width : -bulletWidth),
      y: player.y + player.height / 2 - bulletHeight / 2,
      velX: bulletSpeed * lastDir
    });
    ammo--;
    shootSound.currentTime = 0;
    shootSound.play();
  }
}

function updateEnemy() {
  if (!enemy.alive) return;
  enemy.angle += enemy.speed;
  enemy.x = enemy.baseX + Math.cos(enemy.angle) * enemy.radiusX;
  enemy.y = enemy.baseY + Math.sin(enemy.angle) * enemy.radiusY;
}

function updateBullets() {
  for (let i = bullets.length - 1; i >= 0; i--) {
    bullets[i].x += bullets[i].velX;
    let b = bullets[i];
    if (enemy.alive &&
        b.x < enemy.x + enemy.width &&
        b.x + bulletWidth > enemy.x &&
        b.y < enemy.y + enemy.height &&
        b.y + bulletHeight > enemy.y) {
      enemy.alive = false;
      bullets.splice(i, 1);
      playerImage.src = "hotdog-happy.png";
      player.speed = 1;
      player.jumpForce = -5;
      player.gravity = 0.05;
      player.width = originalWidth;
      player.height = originalHeight;
      explosionSound.currentTime = 0;
      explosionSound.play();
      continue;
    }
    if (bullets[i].x > canvas.width || bullets[i].x + bulletWidth < 0) {
      bullets.splice(i, 1);
    }
  }
}

function drawPlayer() {
  ctx.drawImage(playerImage, player.x * scaleFactor, player.y * scaleFactor, player.width * scaleFactor, player.height * scaleFactor);
}

function drawEnemy() {
  if (enemy.alive) {
    ctx.drawImage(enemyImage, enemy.x * scaleFactor, enemy.y * scaleFactor, enemy.width * scaleFactor, enemy.height * scaleFactor);
  }
}

function drawBullets() {
  bullets.forEach(b => {
    if (bulletImage.complete && bulletImage.naturalWidth) {
      ctx.drawImage(bulletImage, b.x * scaleFactor, b.y * scaleFactor, bulletWidth * scaleFactor, bulletHeight * scaleFactor);
    } else {
      ctx.fillStyle = "red";
      ctx.fillRect(b.x * scaleFactor, b.y * scaleFactor, bulletWidth * scaleFactor, bulletHeight * scaleFactor);
    }
  });
}

function drawGround() {
  ctx.fillStyle = "#555";
  ctx.fillRect(0, floorY * scaleFactor, canvas.width, canvas.height - floorY * scaleFactor);
}

function drawPlatforms() {
  ctx.fillStyle = "#888";
  platforms.forEach(p => ctx.fillRect(p.x * scaleFactor, p.y * scaleFactor, p.width * scaleFactor, p.height * scaleFactor));
}

function drawUI() {
  const iconSize = 60 * scaleFactor;
  for (let i = 0; i < ammo; i++) {
    ctx.drawImage(bulletImage, 20 + i * (iconSize + 5), 20, iconSize, iconSize);
  }
}

function drawHUDText() {
  const text = "Ga≈°piho hra - zp√°rkovan√Ω t√°bor";
  ctx.fillStyle = "#000";
  ctx.font = `${20 * scaleFactor}px sans-serif`;
  ctx.textBaseline = "bottom";
  ctx.fillText(text, 20, canvas.height - 50);
}

function drawEndText() {
  if (!enemy.alive) {
    const text = "KONEC";
    ctx.fillStyle = "#b00";
    ctx.font = `${30 * scaleFactor}px sans-serif`;
    ctx.textBaseline = "bottom";
    const textWidth = ctx.measureText(text).width;
    ctx.fillText(text, canvas.width - textWidth - 20, canvas.height - 10);
  }
}

function gameLoop() {
  ctx.setTransform(scaleFactor, 0, 0, scaleFactor, 0, 0);
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "white";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  updatePlayer();
  updateEnemy();
  updateBullets();

  drawGround();
  drawPlatforms();
  drawBullets();
  drawPlayer();
  drawEnemy();
  drawUI();
  drawHUDText();
  drawEndText();

  requestAnimationFrame(gameLoop);
}

playerImage.onload = () => gameLoop();

// === Dotykov√© ovl√°d√°n√≠ ===
function simulateKey(key, isPressed) {
  keys[key] = isPressed;
  if (key === "a" && isPressed) lastDir = -1;
  if (key === "d" && isPressed) lastDir = 1;
  if ((key === "e" || key === "E") && isPressed) shootBullet();
}

function setupTouchControls() {
  const btns = [
    { id: "leftBtn", key: "a" },
    { id: "rightBtn", key: "d" },
    { id: "jumpBtn", key: "w" },
    { id: "shootBtn", key: "e" },
  ];

  btns.forEach(({ id, key }) => {
    const btn = document.getElementById(id);
    btn.addEventListener("touchstart", (e) => {
      e.preventDefault();
      simulateKey(key, true);
    });
    btn.addEventListener("touchend", (e) => {
      e.preventDefault();
      simulateKey(key, false);
    });
  });
}

window.addEventListener("load", setupTouchControls);
</script>

</body>
</html>
